@startuml
title ScotAccount OIDC Authentication Flow – Public Client with Risk Points

actor User
participant "Mobile App (A)
(Public Client)" as App
participant "Authorisation Server (AS)" as AS
participant "Resource Server (RS)" as RS

== Authentication Flow ==
User -> App : [0] Open App / Initiate Login
App -> AS : [1] Authorisation Request
note right of App
⚠ [1–3] Redirect URI mix-up
or open redirect issues
end note

AS -> User : [2] Prompt for credentials and consent
User -> AS : Provide credentials and approve
AS -> App : [3] Redirect with Code
note right of App
⚠ [2] Code interception possible
(e.g., custom URI hijack)
end note

App -> AS : [4] Token Request (w/code)
note right of App
⚠ [1–3] Redirect URI mix-up
end note

AS -> App : [5] Access Token / ID Token
note right of App
⚠ [4] Token stored insecurely
on device
end note

== Attribute Access ==
App -> RS : [6] API Call with Access Token (Bearer or DPoP)
note right of RS
⚠ [5] Token replay if not sender-constrained
⚠ Token misuse by attacker
if access token leaked
end note

RS -> App : [7] Return Protected Data

@enduml