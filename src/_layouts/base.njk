<!DOCTYPE html>
<html lang="{{ site.language }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if title %}{{ title }} | {% endif %}{{ site.title }}</title>
  <meta name="description" content="{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}">
  <link rel="canonical" href="{{ site.url }}{{ page.url }}">
  
  <!-- Scottish Government favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/css/main.css">
  
  <!-- Open Graph -->
  <meta property="og:title" content="{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}">
  <meta property="og:description" content="{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ site.url }}{{ page.url }}">
  
  <!-- Schema.org -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "headline": "{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}",
    "description": "{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}",
    "author": {
      "@type": "Organization",
      "name": "{{ site.organization.name }}",
      "url": "{{ site.organization.url }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ site.organization.name }}",
      "url": "{{ site.organization.url }}"
    }
  }
  </script>
</head>
<body>
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Header -->
  <header class="header" role="banner">
    <div class="header__container">
      <a href="/" class="header__logo">
        <div>
          <h1 class="header__title">{{ site.title }}</h1>
          <p class="header__subtitle">{{ site.description }}</p>
        </div>
      </a>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="nav" role="navigation" aria-label="Primary navigation">
    <div class="nav__container">
      <ul class="nav__list">
        {% for item in site.navigation %}
        <li class="nav__item">
          <a href="{{ item.url }}" 
             class="nav__link{% if page.url == item.url or (item.key and eleventyNavigation.key == item.key) %} nav__link--active{% endif %}"
             {% if page.url == item.url or (item.key and eleventyNavigation.key == item.key) %}aria-current="page"{% endif %}>
            {{ item.text }}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
  </nav>

  <!-- Main content area -->
  <div class="container">
    <!-- Sidebar with page-specific navigation -->
    {% if collections.all | length > 1 %}
    <aside class="sidebar" role="complementary" aria-label="Page navigation">
      <h2 class="sidebar__title">On this page</h2>
      <nav class="sidebar__nav" aria-label="Page contents">
        <ul class="sidebar__nav">
          <!-- Table of contents will be injected here via JavaScript -->
          <li class="sidebar__nav-item">
            <a href="#" class="sidebar__nav-link" id="toc-placeholder">
              Contents loading...
            </a>
          </li>
        </ul>
      </nav>
      
      {% if collections.all | length > 1 %}
      <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--sg-border-grey);">
      <h3 class="sidebar__title">All pages</h3>
      <ul class="sidebar__nav">
        {% for page in collections.all %}
          {% if page.url != "/" %}
          <li class="sidebar__nav-item">
            <a href="{{ page.url }}" 
               class="sidebar__nav-link{% if page.url == pagination.href %} sidebar__nav-link--active{% endif %}">
              {{ page.data.title or page.data.eleventyNavigation.title or "Untitled" }}
            </a>
          </li>
          {% endif %}
        {% endfor %}
      </ul>
      {% endif %}
    </aside>
    {% endif %}

    <!-- Main content -->
    <main class="main" id="main-content" role="main" tabindex="-1">
      {% if title %}
        <h1>{{ title }}</h1>
      {% endif %}
      
      {% if description and title %}
        <p class="lead">{{ description }}</p>
      {% endif %}

      <!-- Page content -->
      {{ content | safe }}

      <!-- Last updated -->
      {% if page.date %}
      <footer class="content-footer">
        <p><small>Last updated: {{ page.date | dateDisplay }}</small></p>
      </footer>
      {% endif %}
    </main>
  </div>

  <!-- Site footer -->
  <footer class="footer" role="contentinfo">
    <div class="footer__container">
      <div class="footer__content">
        <div class="footer__section">
          <h3>ScotAccount</h3>
          <ul class="footer__links">
            <li><a href="/">Documentation home</a></li>
            <li><a href="/getting-started/">Getting started</a></li>
            <li><a href="/scotaccount-complete-guide/">Complete guide</a></li>
          </ul>
        </div>
        
        <div class="footer__section">
          <h3>Scottish Government</h3>
          <ul class="footer__links">
            <li><a href="https://www.gov.scot" target="_blank" rel="noopener">gov.scot</a></li>
            <li><a href="https://www.gov.scot/about/how-government-is-run/directorates/digital-directorate/" target="_blank" rel="noopener">Digital Directorate</a></li>
            <li><a href="https://www.gov.scot/publications/" target="_blank" rel="noopener">Publications</a></li>
          </ul>
        </div>
        
        <div class="footer__section">
          <h3>Help and support</h3>
          <ul class="footer__links">
            <li><a href="https://www.gov.scot/about/contact-information/" target="_blank" rel="noopener">Contact us</a></li>
            <li><a href="https://www.gov.scot/accessibility/" target="_blank" rel="noopener">Accessibility</a></li>
            <li><a href="https://www.gov.scot/privacy/" target="_blank" rel="noopener">Privacy</a></li>
            <li><a href="https://www.gov.scot/cookies/" target="_blank" rel="noopener">Cookies</a></li>
          </ul>
        </div>
      </div>
      
      <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #555; text-align: center;">
        <p>&copy; Crown Copyright. All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank" rel="noopener">Open Government Licence v3.0</a>, except where otherwise stated.</p>
      </div>
    </div>
  </footer>

  <!-- JavaScript for table of contents generation -->
  <script>
    // Generate table of contents for better scannable structure
    document.addEventListener('DOMContentLoaded', function() {
      const headings = document.querySelectorAll('main h2, main h3, main h4');
      const tocContainer = document.querySelector('.sidebar__nav');
      const placeholder = document.getElementById('toc-placeholder');
      
      if (headings.length > 0 && tocContainer && placeholder) {
        // Remove placeholder
        placeholder.remove();
        
        // Generate TOC
        headings.forEach(function(heading, index) {
          // Add ID to heading if it doesn't have one
          if (!heading.id) {
            heading.id = 'heading-' + index;
          }
          
          // Create TOC item
          const li = document.createElement('li');
          li.className = 'sidebar__nav-item';
          
          const a = document.createElement('a');
          a.href = '#' + heading.id;
          a.className = 'sidebar__nav-link';
          a.textContent = heading.textContent;
          
          // Add visual hierarchy for different heading levels
          if (heading.tagName === 'H3') {
            a.style.paddingLeft = '2rem';
          } else if (heading.tagName === 'H4') {
            a.style.paddingLeft = '3rem';
          }
          
          li.appendChild(a);
          tocContainer.appendChild(li);
        });
      } else if (placeholder) {
        placeholder.textContent = 'No headings found';
      }
      
      // Smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
    });
  </script>
</body>
</html> 